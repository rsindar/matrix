---
- name: Install Caddy (RHEL/AlmaLinux/Rocky)
  ansible.builtin.yum:
    name: caddy
    state: present
  when: ansible_os_family == "RedHat"

- name: Install Caddy (Debian/Ubuntu)
  ansible.builtin.apt:
    name: caddy
    state: present
    update_cache: true
  when: ansible_os_family == "Debian"

- name: Copy Caddy configuration
  ansible.builtin.template:
    src: Caddyfile.j2
    dest: /etc/caddy/Caddyfile
    mode: "0640"
    owner: root
    group: root
  notify: Restart caddy

- name: Start Caddy service
  ansible.builtin.systemd:
    name: caddy.service
    state: started
    enabled: true
